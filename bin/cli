#!/usr/bin/env ruby

require "./lib/btc_sender"
require "./lib/btc_sender/cli"

network = case ARGV
          when ["--testnet"]
            :testnet
          when ["--signet"]
            :signet
          else
            :mainnet
          end

Bitcoin.chain_params = network

address = BtcSender::Key.new(Bitcoin::Key)
if ARGV.include?("--path")
  key = address.restore(ARGV[ARGV.index("--path") + 1])
else
  key = address.restore
end

blockchain = BtcSender::Blockchain.new(network: network)
engine = BtcSender::Engine.new(key: key, blockchain: blockchain)

BtcSender::CLI.new(engine: engine).run
